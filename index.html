<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GetItDone">
    <title>GetItDone - Workout Tracker</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const HomeIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
        );

        const DumbbellIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6.5 6h11l-1 7-4 4-4-4-1-7z"/>
                <path d="M6.5 6l-1-1"/>
                <path d="M17.5 6l1-1"/>
                <path d="M6.5 6l-1 1"/>
                <path d="M17.5 6l1 1"/>
            </svg>
        );

        const CalendarIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const BarChartIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="20" x2="12" y2="10"/>
                <line x1="18" y1="20" x2="18" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="16"/>
            </svg>
        );

        const PlayIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5,3 19,12 5,21"/>
            </svg>
        );

        const PlusIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const TrashIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3,6 5,6 21,6"/>
                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
            </svg>
        );

        const CheckIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20,6 9,17 4,12"/>
            </svg>
        );

        const ArrowRightIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12,5 19,12 12,19"/>
            </svg>
        );

        const ArrowLeftIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12,19 5,12 12,5"/>
            </svg>
        );

        const ChevronDownIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6,9 12,15 18,9"/>
            </svg>
        );

        const ChevronUpIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="18,15 12,9 6,15"/>
            </svg>
        );

        const GripIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="9" cy="12" r="1"/>
                <circle cx="9" cy="5" r="1"/>
                <circle cx="9" cy="19" r="1"/>
                <circle cx="20" cy="12" r="1"/>
                <circle cx="20" cy="5" r="1"/>
                <circle cx="20" cy="19" r="1"/>
            </svg>
        );

        const StarIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"/>
            </svg>
        );

        // Workout data with injury modifications
        const workoutDatabase = {
            upperBody: {
                exercises: [
                    { name: "Bench Press", sets: 4, reps: "8-12", weight: "Body weight", equipment: "Barbell", muscleGroups: ["Chest", "Triceps", "Shoulders"], injuryNotes: "Avoid if shoulder impingement", hasWeight: true },
                    { name: "Pull-ups", sets: 3, reps: "6-10", weight: "Body weight", equipment: "Pull-up bar", muscleGroups: ["Back", "Biceps"], injuryNotes: "Use assisted if shoulder issues", hasWeight: false },
                    { name: "Overhead Press", sets: 3, reps: "8-12", weight: "Light to moderate", equipment: "Dumbbells", muscleGroups: ["Shoulders", "Triceps"], injuryNotes: "Avoid if shoulder impingement", hasWeight: true },
                    { name: "Bent-over Rows", sets: 3, reps: "8-12", weight: "Moderate", equipment: "Barbell", muscleGroups: ["Back", "Biceps"], injuryNotes: "Keep back straight, avoid if lower back issues", hasWeight: true },
                    { name: "Dips", sets: 3, reps: "8-15", weight: "Body weight", equipment: "Dip bars", muscleGroups: ["Chest", "Triceps"], injuryNotes: "Use assisted if shoulder issues", hasWeight: false },
                    { name: "Bicep Curls", sets: 3, reps: "10-15", weight: "Light to moderate", equipment: "Dumbbells", muscleGroups: ["Biceps"], injuryNotes: "Avoid if elbow tendonitis", hasWeight: true },
                    { name: "Tricep Extensions", sets: 3, reps: "10-15", weight: "Light", equipment: "Dumbbells", muscleGroups: ["Triceps"], injuryNotes: "Avoid if elbow issues", hasWeight: true },
                    { name: "Lateral Raises", sets: 3, reps: "12-15", weight: "Light", equipment: "Dumbbells", muscleGroups: ["Shoulders"], injuryNotes: "Avoid if shoulder impingement", hasWeight: true }
                ]
            },
            lowerBody: {
                exercises: [
                    { name: "Squats", sets: 4, reps: "8-12", weight: "Body weight to moderate", equipment: "Barbell", muscleGroups: ["Quads", "Glutes"], injuryNotes: "Avoid if knee issues, use box squats", hasWeight: true },
                    { name: "Deadlifts", sets: 3, reps: "5-8", weight: "Moderate to heavy", equipment: "Barbell", muscleGroups: ["Hamstrings", "Glutes", "Back"], injuryNotes: "Avoid if lower back issues", hasWeight: true },
                    { name: "Lunges", sets: 3, reps: "10-12 each leg", weight: "Body weight to light", equipment: "Dumbbells", muscleGroups: ["Quads", "Glutes"], injuryNotes: "Avoid if knee issues", hasWeight: true },
                    { name: "Leg Press", sets: 3, reps: "12-15", weight: "Moderate", equipment: "Leg press machine", muscleGroups: ["Quads", "Glutes"], injuryNotes: "Safer alternative to squats", hasWeight: true },
                    { name: "Romanian Deadlifts", sets: 3, reps: "8-12", weight: "Light to moderate", equipment: "Dumbbells", muscleGroups: ["Hamstrings", "Glutes"], injuryNotes: "Avoid if lower back issues", hasWeight: true },
                    { name: "Calf Raises", sets: 3, reps: "15-20", weight: "Body weight to moderate", equipment: "Calf raise machine", muscleGroups: ["Calves"], injuryNotes: "Safe for most injuries", hasWeight: true },
                    { name: "Hip Thrusts", sets: 3, reps: "12-15", weight: "Body weight to moderate", equipment: "Barbell", muscleGroups: ["Glutes"], injuryNotes: "Safe for most injuries", hasWeight: true },
                    { name: "Leg Curls", sets: 3, reps: "12-15", weight: "Light to moderate", equipment: "Leg curl machine", muscleGroups: ["Hamstrings"], injuryNotes: "Safe for most injuries", hasWeight: true }
                ]
            },
            circuit: {
                exercises: [
                    { name: "Push-ups", sets: 3, reps: "8-15", weight: "Body weight", equipment: "None", muscleGroups: ["Chest", "Triceps"], injuryNotes: "Modify if shoulder issues", hasWeight: false },
                    { name: "Mountain Climbers", sets: 3, reps: "20-30 seconds", weight: "Body weight", equipment: "None", muscleGroups: ["Core", "Cardio"], injuryNotes: "Avoid if knee issues", hasWeight: false },
                    { name: "Burpees", sets: 3, reps: "5-10", weight: "Body weight", equipment: "None", muscleGroups: ["Full body", "Cardio"], injuryNotes: "Modify if knee or shoulder issues", hasWeight: false },
                    { name: "Plank", sets: 3, reps: "30-60 seconds", weight: "Body weight", equipment: "None", muscleGroups: ["Core"], injuryNotes: "Safe for most injuries", hasWeight: false },
                    { name: "Jump Squats", sets: 3, reps: "10-15", weight: "Body weight", equipment: "None", muscleGroups: ["Quads", "Glutes"], injuryNotes: "Avoid if knee issues", hasWeight: false },
                    { name: "High Knees", sets: 3, reps: "20-30 seconds", weight: "Body weight", equipment: "None", muscleGroups: ["Cardio", "Core"], injuryNotes: "Avoid if knee issues", hasWeight: false }
                ]
            },
            surfing: {
                exercises: [
                    { name: "Surfer's Stretch", sets: 2, reps: "30-60 seconds", weight: "Body weight", equipment: "None", muscleGroups: ["Hip flexors", "Core"], injuryNotes: "Great for hip mobility", hasWeight: false },
                    { name: "Paddle Simulation", sets: 3, reps: "20-30 seconds", weight: "Body weight", equipment: "None", muscleGroups: ["Shoulders", "Core"], injuryNotes: "Mimics paddling motion", hasWeight: false },
                    { name: "Pop-up Practice", sets: 3, reps: "10-15", weight: "Body weight", equipment: "None", muscleGroups: ["Core", "Legs"], injuryNotes: "Practice getting up on board", hasWeight: false },
                    { name: "Hip Circles", sets: 2, reps: "10 each direction", weight: "Body weight", equipment: "None", muscleGroups: ["Hip mobility"], injuryNotes: "Improves hip flexibility", hasWeight: false }
                ]
            }
        };

        // YouTube search function
        const getYouTubeSearchUrl = (exerciseName) => {
            const preferredChannels = ["Athlean-X", "Jeremy Ethier", "deltabolic"];
            const searchQuery = `${exerciseName} ${preferredChannels[Math.floor(Math.random() * preferredChannels.length)]}`;
            return `https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`;
        };

        // Back Button Component
        const BackButton = ({ onClick, className = "" }) => (
            <button
                onClick={onClick}
                className={`flex items-center gap-2 text-gray-400 hover:text-white transition ${className}`}
            >
                <ArrowLeftIcon />
                Back
            </button>
        );

        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('home');
            const [workoutType, setWorkoutType] = useState('');
            const [workoutFocus, setWorkoutFocus] = useState('');
            const [injuries, setInjuries] = useState([]);
            const [selectedExercises, setSelectedExercises] = useState([]);
            const [workoutOrder, setWorkoutOrder] = useState([]);
            const [currentExerciseIndex, setCurrentExerciseIndex] = useState(0);
            const [workoutLog, setWorkoutLog] = useState({});
            const [workoutStartTime, setWorkoutStartTime] = useState(null);
            const [completedWorkouts, setCompletedWorkouts] = useState([]);
            const [expandedExercises, setExpandedExercises] = useState({});
            const [exerciseDetails, setExerciseDetails] = useState({});

            // Initialize IndexedDB
            useEffect(() => {
                const initDB = async () => {
                    const request = indexedDB.open('GetItDoneDB', 1);
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('workouts')) {
                            db.createObjectStore('workouts', { keyPath: 'id', autoIncrement: true });
                        }
                        if (!db.objectStoreNames.contains('profile')) {
                            db.createObjectStore('profile', { keyPath: 'id' });
                        }
                    };
                };
                initDB();
            }, []);

            // Save workout to IndexedDB
            const saveWorkout = async (workoutData) => {
                const request = indexedDB.open('GetItDoneDB', 1);
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['workouts'], 'readwrite');
                    const store = transaction.objectStore('workouts');
                    store.add(workoutData);
                };
            };

            // Get available exercises based on workout type and injuries
            const getAvailableExercises = () => {
                let exercises = [];
                
                if (workoutType === 'Gym') {
                    if (workoutFocus === 'Upper Body') {
                        exercises = [...workoutDatabase.upperBody.exercises];
                    } else if (workoutFocus === 'Lower Body') {
                        exercises = [...workoutDatabase.lowerBody.exercises];
                    } else if (workoutFocus === 'Circuit') {
                        exercises = [...workoutDatabase.circuit.exercises];
                    }
                }

                // Filter out exercises that might aggravate injuries
                if (injuries.length > 0) {
                    exercises = exercises.filter(exercise => {
                        return !injuries.some(injury => 
                            exercise.injuryNotes.toLowerCase().includes(injury.toLowerCase())
                        );
                    });
                }

                return exercises;
            };

            // Navigation functions
            const goBack = () => {
                const viewHistory = {
                    'workoutType': 'home',
                    'workoutFocus': 'workoutType',
                    'injurySelection': workoutType === 'Gym' ? 'workoutFocus' : 'workoutType',
                    'exerciseSelection': 'injurySelection',
                    'exerciseOrdering': 'exerciseSelection',
                    'activeWorkout': 'exerciseOrdering',
                    'workoutComplete': 'home'
                };
                setCurrentView(viewHistory[currentView] || 'home');
            };

            // Start workout selection
            const startWorkoutSelection = () => {
                setCurrentView('workoutType');
            };

            // Handle workout type selection
            const handleWorkoutTypeSelection = (type) => {
                setWorkoutType(type);
                if (type === 'Gym') {
                    setCurrentView('workoutFocus');
                } else {
                    setCurrentView('injurySelection');
                }
            };

            // Handle workout focus selection
            const handleWorkoutFocusSelection = (focus) => {
                setWorkoutFocus(focus);
                setCurrentView('injurySelection');
            };

            // Handle injury selection
            const handleInjurySelection = (injury) => {
                if (injuries.includes(injury)) {
                    setInjuries(injuries.filter(i => i !== injury));
                } else {
                    setInjuries([...injuries, injury]);
                }
            };

            // Proceed to exercise selection
            const proceedToExerciseSelection = () => {
                setCurrentView('exerciseSelection');
            };

            // Handle exercise selection
            const handleExerciseSelection = (exercise) => {
                if (selectedExercises.find(e => e.name === exercise.name)) {
                    setSelectedExercises(selectedExercises.filter(e => e.name !== exercise.name));
                } else {
                    setSelectedExercises([...selectedExercises, exercise]);
                }
            };

            // Toggle exercise expansion
            const toggleExerciseExpansion = (exerciseName) => {
                setExpandedExercises(prev => ({
                    ...prev,
                    [exerciseName]: !prev[exerciseName]
                }));
            };

            // Handle exercise details change
            const handleExerciseDetailsChange = (exerciseName, field, value) => {
                setExerciseDetails(prev => ({
                    ...prev,
                    [exerciseName]: {
                        ...prev[exerciseName],
                        [field]: value
                    }
                }));
            };

            // Create circuit from selected exercises
            const createCircuit = () => {
                const exercisesWithDetails = selectedExercises.map(exercise => ({
                    ...exercise,
                    customSets: exerciseDetails[exercise.name]?.sets || exercise.sets,
                    customReps: exerciseDetails[exercise.name]?.reps || exercise.reps,
                    customWeight: exerciseDetails[exercise.name]?.weight || exercise.weight
                }));
                setWorkoutOrder(exercisesWithDetails);
                setCurrentView('exerciseOrdering');
            };

            // Start individual exercise
            const startIndividualExercise = (exercise) => {
                const exerciseWithDetails = {
                    ...exercise,
                    customSets: exerciseDetails[exercise.name]?.sets || exercise.sets,
                    customReps: exerciseDetails[exercise.name]?.reps || exercise.reps,
                    customWeight: exerciseDetails[exercise.name]?.weight || exercise.weight
                };
                setWorkoutOrder([exerciseWithDetails]);
                setCurrentView('exerciseOrdering');
            };

            // Reorder exercises
            const reorderExercises = (newOrder) => {
                setWorkoutOrder(newOrder);
            };

            // Start workout
            const startWorkout = () => {
                setCurrentExerciseIndex(0);
                setWorkoutStartTime(new Date());
                setCurrentView('activeWorkout');
            };

            // Handle set logging
            const handleSetLog = (exerciseName, setIndex, field, value) => {
                setWorkoutLog(prev => ({
                    ...prev,
                    [exerciseName]: {
                        ...prev[exerciseName],
                        [setIndex]: {
                            ...prev[exerciseName]?.[setIndex],
                            [field]: value
                        }
                    }
                }));
            };

            // Add set
            const addSet = (exerciseName) => {
                const currentSets = workoutLog[exerciseName] || {};
                const setCount = Object.keys(currentSets).length;
                setWorkoutLog(prev => ({
                    ...prev,
                    [exerciseName]: {
                        ...prev[exerciseName],
                        [setCount]: { weight: '', reps: '' }
                    }
                }));
            };

            // Remove set
            const removeSet = (exerciseName, setIndex) => {
                setWorkoutLog(prev => {
                    const newLog = { ...prev };
                    if (newLog[exerciseName]) {
                        delete newLog[exerciseName][setIndex];
                    }
                    return newLog;
                });
            };

            // Complete exercise
            const completeExercise = () => {
                nextExercise();
            };

            // Next exercise
            const nextExercise = () => {
                if (currentExerciseIndex < workoutOrder.length - 1) {
                    setCurrentExerciseIndex(currentExerciseIndex + 1);
                } else {
                    setCurrentView('workoutComplete');
                }
            };

            // Skip exercise
            const skipExercise = () => {
                nextExercise();
            };

            // Change exercise
            const changeExercise = () => {
                setCurrentView('exerciseSelection');
            };

            // Complete workout
            const completeWorkout = () => {
                const workoutData = {
                    id: Date.now(),
                    type: workoutType,
                    focus: workoutFocus,
                    exercises: workoutOrder,
                    log: workoutLog,
                    startTime: workoutStartTime,
                    endTime: new Date(),
                    duration: Math.round((new Date() - workoutStartTime) / 60000)
                };
                
                setCompletedWorkouts(prev => [...prev, workoutData]);
                saveWorkout(workoutData);
                setCurrentView('home');
                
                // Reset state
                setWorkoutType('');
                setWorkoutFocus('');
                setInjuries([]);
                setSelectedExercises([]);
                setWorkoutOrder([]);
                setCurrentExerciseIndex(0);
                setWorkoutLog({});
                setWorkoutStartTime(null);
                setExpandedExercises({});
                setExerciseDetails({});
            };

            // Render current view
            const renderCurrentView = () => {
                switch (currentView) {
                    case 'home':
                        return <HomeView onStartWorkout={startWorkoutSelection} completedWorkouts={completedWorkouts} />;
                    case 'workoutType':
                        return <WorkoutTypeSelection onSelect={handleWorkoutTypeSelection} onBack={goBack} />;
                    case 'workoutFocus':
                        return <WorkoutFocusSelection onSelect={handleWorkoutFocusSelection} onBack={goBack} />;
                    case 'injurySelection':
                        return <InjurySelection injuries={injuries} onToggle={handleInjurySelection} onProceed={proceedToExerciseSelection} onBack={goBack} />;
                    case 'exerciseSelection':
                        return <ExerciseSelection 
                            exercises={getAvailableExercises()} 
                            selectedExercises={selectedExercises}
                            onSelect={handleExerciseSelection}
                            onCreateCircuit={createCircuit}
                            onStartIndividual={startIndividualExercise}
                            injuries={injuries}
                            expandedExercises={expandedExercises}
                            onToggleExpansion={toggleExerciseExpansion}
                            exerciseDetails={exerciseDetails}
                            onDetailsChange={handleExerciseDetailsChange}
                            onBack={goBack}
                        />;
                    case 'exerciseOrdering':
                        return <ExerciseOrdering 
                            exercises={workoutOrder}
                            onStart={startWorkout}
                            onReorder={reorderExercises}
                            onBack={goBack}
                        />;
                    case 'activeWorkout':
                        return <ActiveWorkout 
                            exercise={workoutOrder[currentExerciseIndex]}
                            exerciseIndex={currentExerciseIndex}
                            totalExercises={workoutOrder.length}
                            workoutLog={workoutLog}
                            onSetLog={handleSetLog}
                            onAddSet={addSet}
                            onRemoveSet={removeSet}
                            onNext={nextExercise}
                            onSkip={skipExercise}
                            onChange={changeExercise}
                            onComplete={completeExercise}
                            onBack={goBack}
                        />;
                    case 'workoutComplete':
                        return <WorkoutComplete onComplete={completeWorkout} onBack={goBack} />;
                    default:
                        return <HomeView onStartWorkout={startWorkoutSelection} completedWorkouts={completedWorkouts} />;
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 text-white">
                    {renderCurrentView()}
                </div>
            );
        };

        // Home View Component
        const HomeView = ({ onStartWorkout, completedWorkouts }) => {
            const today = new Date().toDateString();
            const todayWorkouts = completedWorkouts.filter(w => 
                new Date(w.startTime).toDateString() === today
            );

            return (
                <div className="p-6">
                    <div className="text-center mb-8">
                        <h1 className="text-4xl font-bold text-blue-400 mb-2">GetItDone</h1>
                        <p className="text-gray-300">Your Personal Workout Tracker</p>
                    </div>

                    <div className="space-y-6">
                        <button 
                            onClick={onStartWorkout}
                            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition flex items-center justify-center gap-3"
                        >
                            <DumbbellIcon />
                            Start Workout
                        </button>

                        {todayWorkouts.length > 0 && (
                            <div className="bg-green-900/50 border border-green-500 rounded-xl p-4">
                                <h3 className="text-green-400 font-bold mb-2">Today's Workouts</h3>
                                {todayWorkouts.map(workout => (
                                    <div key={workout.id} className="text-sm text-gray-300">
                                        {workout.type} - {workout.focus} ({workout.duration} min)
                                    </div>
                                ))}
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-4">
                            <button className="bg-gray-800 hover:bg-gray-700 p-4 rounded-xl transition">
                                <CalendarIcon />
                                <div className="text-sm mt-2">Weekly Plan</div>
                            </button>
                            <button className="bg-gray-800 hover:bg-gray-700 p-4 rounded-xl transition">
                                <BarChartIcon />
                                <div className="text-sm mt-2">Progress</div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Workout Type Selection Component
        const WorkoutTypeSelection = ({ onSelect, onBack }) => {
            const workoutTypes = [
                { name: 'Gym', icon: <DumbbellIcon />, color: 'bg-blue-600' },
                { name: 'Run', icon: <PlayIcon />, color: 'bg-green-600' },
                { name: 'Swim', icon: <PlayIcon />, color: 'bg-cyan-600' },
                { name: 'Bike', icon: <PlayIcon />, color: 'bg-orange-600' },
                { name: 'Home', icon: <HomeIcon />, color: 'bg-purple-600' }
            ];

            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <h2 className="text-2xl font-bold mb-6">Choose Your Workout</h2>
                    <div className="space-y-4">
                        {workoutTypes.map(type => (
                            <button
                                key={type.name}
                                onClick={() => onSelect(type.name)}
                                className={`w-full ${type.color} hover:opacity-90 text-white font-bold py-4 px-6 rounded-xl transition flex items-center gap-4`}
                            >
                                {type.icon}
                                {type.name}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Workout Focus Selection Component
        const WorkoutFocusSelection = ({ onSelect, onBack }) => {
            const focusOptions = [
                { name: 'Upper Body', description: 'Chest, back, shoulders, arms' },
                { name: 'Lower Body', description: 'Legs, glutes, calves' },
                { name: 'Circuit', description: 'Full body circuit training' }
            ];

            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <h2 className="text-2xl font-bold mb-6">What would you like to focus on?</h2>
                    <div className="space-y-4">
                        {focusOptions.map(option => (
                            <button
                                key={option.name}
                                onClick={() => onSelect(option.name)}
                                className="w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 px-6 rounded-xl transition text-left"
                            >
                                <div className="font-bold">{option.name}</div>
                                <div className="text-sm text-gray-300">{option.description}</div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Injury Selection Component
        const InjurySelection = ({ injuries, onToggle, onProceed, onBack }) => {
            const commonInjuries = [
                'Shoulder impingement',
                'Lower back pain',
                'Knee issues',
                'Elbow tendonitis',
                'Wrist problems',
                'Ankle issues',
                'Neck pain'
            ];

            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <h2 className="text-2xl font-bold mb-6">Any injuries to be careful of?</h2>
                    <div className="space-y-3 mb-6">
                        {commonInjuries.map(injury => (
                            <button
                                key={injury}
                                onClick={() => onToggle(injury)}
                                className={`w-full text-left p-4 rounded-xl transition ${
                                    injuries.includes(injury) 
                                        ? 'bg-red-600 text-white' 
                                        : 'bg-gray-800 hover:bg-gray-700 text-white'
                                }`}
                            >
                                {injury}
                            </button>
                        ))}
                    </div>
                    <button
                        onClick={onProceed}
                        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition"
                    >
                        Continue
                    </button>
                </div>
            );
        };

        // Exercise Selection Component
        const ExerciseSelection = ({ exercises, selectedExercises, onSelect, onCreateCircuit, onStartIndividual, injuries, expandedExercises, onToggleExpansion, exerciseDetails, onDetailsChange, onBack }) => {
            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <h2 className="text-2xl font-bold mb-6">Choose Your Exercises</h2>
                    
                    {injuries.length > 0 && (
                        <div className="bg-yellow-900/50 border border-yellow-500 rounded-xl p-4 mb-6">
                            <h3 className="text-yellow-400 font-bold mb-2">Injury Modifications</h3>
                            <p className="text-sm text-gray-300">
                                Exercises have been filtered to avoid aggravating: {injuries.join(', ')}
                            </p>
                        </div>
                    )}

                    <div className="space-y-4 mb-6">
                        {exercises.map(exercise => (
                            <div key={exercise.name} className="bg-gray-800 rounded-xl p-4">
                                <div className="flex items-center justify-between">
                                    <div className="flex-1">
                                        <h3 className="font-bold text-lg">{exercise.name}</h3>
                                        <p className="text-sm text-gray-300">
                                            {exercise.sets} sets × {exercise.reps} reps
                                        </p>
                                        <p className="text-sm text-gray-400">
                                            Equipment: {exercise.equipment}
                                        </p>
                                        {exercise.injuryNotes && (
                                            <p className="text-sm text-yellow-400 mt-1">
                                                ⚠️ {exercise.injuryNotes}
                                            </p>
                                        )}
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => window.open(getYouTubeSearchUrl(exercise.name), '_blank')}
                                            className="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition"
                                        >
                                            <PlayIcon />
                                        </button>
                                        <button
                                            onClick={() => onSelect(exercise)}
                                            className={`p-2 rounded-lg transition ${
                                                selectedExercises.find(e => e.name === exercise.name)
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-gray-600 hover:bg-gray-500 text-white'
                                            }`}
                                        >
                                            <CheckIcon />
                                        </button>
                                        <button
                                            onClick={() => onToggleExpansion(exercise.name)}
                                            className="bg-gray-600 hover:bg-gray-500 text-white p-2 rounded-lg transition"
                                        >
                                            {expandedExercises[exercise.name] ? <ChevronUpIcon /> : <ChevronDownIcon />}
                                        </button>
                                    </div>
                                </div>
                                
                                {expandedExercises[exercise.name] && (
                                    <div className="mt-4 pt-4 border-t border-gray-700">
                                        <h4 className="font-bold mb-3">Customize Exercise</h4>
                                        <div className="grid grid-cols-1 gap-4">
                                            <div>
                                                <label className="text-sm text-gray-300">Sets</label>
                                                <input
                                                    type="number"
                                                    value={exerciseDetails[exercise.name]?.sets || exercise.sets}
                                                    onChange={(e) => onDetailsChange(exercise.name, 'sets', e.target.value)}
                                                    className="w-full bg-gray-700 text-white p-2 rounded-lg mt-1"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-sm text-gray-300">Reps</label>
                                                <input
                                                    type="text"
                                                    value={exerciseDetails[exercise.name]?.reps || exercise.reps}
                                                    onChange={(e) => onDetailsChange(exercise.name, 'reps', e.target.value)}
                                                    className="w-full bg-gray-700 text-white p-2 rounded-lg mt-1"
                                                    placeholder="e.g., 8-12 or 30 seconds"
                                                />
                                            </div>
                                            {exercise.hasWeight && (
                                                <div>
                                                    <label className="text-sm text-gray-300">Weight</label>
                                                    <input
                                                        type="text"
                                                        value={exerciseDetails[exercise.name]?.weight || exercise.weight}
                                                        onChange={(e) => onDetailsChange(exercise.name, 'weight', e.target.value)}
                                                        className="w-full bg-gray-700 text-white p-2 rounded-lg mt-1"
                                                        placeholder="e.g., 50 lbs or Body weight"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>

                    <div className="space-y-4">
                        {selectedExercises.length > 0 && (
                            <button
                                onClick={onCreateCircuit}
                                className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition"
                            >
                                Create Circuit ({selectedExercises.length} exercises)
                            </button>
                        )}
                        
                        <button
                            onClick={() => onStartIndividual(exercises[0])}
                            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition"
                        >
                            Start Individual Exercise
                        </button>
                    </div>
                </div>
            );
        };

        // Exercise Ordering Component
        const ExerciseOrdering = ({ exercises, onStart, onReorder, onBack }) => {
            const [sortableId] = useState('exercise-list');

            useEffect(() => {
                if (exercises.length > 1) {
                    const sortable = new Sortable(document.getElementById(sortableId), {
                        animation: 150,
                        onEnd: (evt) => {
                            const newOrder = [...exercises];
                            const [removed] = newOrder.splice(evt.oldIndex, 1);
                            newOrder.splice(evt.newIndex, 0, removed);
                            onReorder(newOrder);
                        }
                    });
                    return () => sortable.destroy();
                }
            }, [exercises]);

            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <h2 className="text-2xl font-bold mb-6">Your Workout Plan</h2>
                    <div id={sortableId} className="space-y-4 mb-6">
                        {exercises.map((exercise, index) => (
                            <div key={exercise.name} className="bg-gray-800 rounded-xl p-4 flex items-center gap-4">
                                {exercises.length > 1 && (
                                    <div className="text-gray-400 cursor-move">
                                        <GripIcon />
                                    </div>
                                )}
                                <div className="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                                    {index + 1}
                                </div>
                                <div className="flex-1">
                                    <h3 className="font-bold">{exercise.name}</h3>
                                    <p className="text-sm text-gray-300">
                                        {exercise.customSets || exercise.sets} sets × {exercise.customReps || exercise.reps} reps
                                    </p>
                                    {exercise.hasWeight && (
                                        <p className="text-sm text-gray-400">
                                            Weight: {exercise.customWeight || exercise.weight}
                                        </p>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                    <button
                        onClick={onStart}
                        className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition"
                    >
                        Start Workout
                    </button>
                </div>
            );
        };

        // Active Workout Component
        const ActiveWorkout = ({ exercise, exerciseIndex, totalExercises, workoutLog, onSetLog, onAddSet, onRemoveSet, onNext, onSkip, onChange, onComplete, onBack }) => {
            const currentSets = workoutLog[exercise.name] || {};
            const setCount = Object.keys(currentSets).length;

            return (
                <div className="p-6">
                    <BackButton onClick={onBack} className="mb-6" />
                    <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold">{exercise.name}</h2>
                        <p className="text-gray-300">
                            Exercise {exerciseIndex + 1} of {totalExercises}
                        </p>
                    </div>

                    <div className="bg-gray-800 rounded-xl p-4 mb-6">
                        <h3 className="font-bold mb-2">Target: {exercise.customSets || exercise.sets} sets × {exercise.customReps || exercise.reps} reps</h3>
                        <p className="text-sm text-gray-300">Equipment: {exercise.equipment}</p>
                        {exercise.injuryNotes && (
                            <p className="text-sm text-yellow-400 mt-2">⚠️ {exercise.injuryNotes}</p>
                        )}
                    </div>

                    <div className="mb-6">
                        <button
                            onClick={() => window.open(getYouTubeSearchUrl(exercise.name), '_blank')}
                            className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition flex items-center justify-center gap-2"
                        >
                            <PlayIcon />
                            Watch Exercise Tutorial
                        </button>
                    </div>

                    <div className="space-y-4 mb-6">
                        <h3 className="font-bold">Log Your Sets</h3>
                        {Object.keys(currentSets).map(setIndex => (
                            <div key={setIndex} className="bg-gray-800 rounded-xl p-4">
                                <div className="flex items-center gap-4">
                                    <div className="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                                        {parseInt(setIndex) + 1}
                                    </div>
                                    <div className="flex-1 grid grid-cols-2 gap-4">
                                        {exercise.hasWeight && (
                                            <div>
                                                <label className="text-sm text-gray-300">Weight</label>
                                                <input
                                                    type="text"
                                                    value={currentSets[setIndex]?.weight || ''}
                                                    onChange={(e) => onSetLog(exercise.name, setIndex, 'weight', e.target.value)}
                                                    className="w-full bg-gray-700 text-white p-2 rounded-lg"
                                                    placeholder="Weight"
                                                />
                                            </div>
                                        )}
                                        <div>
                                            <label className="text-sm text-gray-300">Reps</label>
                                            <input
                                                type="text"
                                                value={currentSets[setIndex]?.reps || ''}
                                                onChange={(e) => onSetLog(exercise.name, setIndex, 'reps', e.target.value)}
                                                className="w-full bg-gray-700 text-white p-2 rounded-lg"
                                                placeholder="Reps"
                                            />
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => onRemoveSet(exercise.name, setIndex)}
                                        className="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg transition"
                                    >
                                        <TrashIcon />
                                    </button>
                                </div>
                            </div>
                        ))}
                        
                        <button
                            onClick={() => onAddSet(exercise.name)}
                            className="w-full bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded-xl transition flex items-center justify-center gap-2"
                        >
                            <PlusIcon />
                            Add Set
                        </button>
                    </div>

                    <div className="space-y-4">
                        <button
                            onClick={onComplete}
                            className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition flex items-center justify-center gap-2"
                        >
                            <CheckIcon />
                            Complete Exercise
                        </button>
                        
                        <div className="grid grid-cols-2 gap-4">
                            <button
                                onClick={onSkip}
                                className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-xl transition"
                            >
                                Skip
                            </button>
                            <button
                                onClick={onChange}
                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition"
                            >
                                Change Exercise
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Workout Complete Component
        const WorkoutComplete = ({ onComplete, onBack }) => {
            return (
                <div className="p-6 text-center">
                    <BackButton onClick={onBack} className="mb-6" />
                    <div className="mb-8">
                        <div className="bg-green-600 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                            <CheckIcon />
                        </div>
                        <h2 className="text-3xl font-bold text-green-400 mb-2">Workout Complete!</h2>
                        <p className="text-gray-300">Great job! You've finished your workout.</p>
                    </div>
                    
                    <button
                        onClick={onComplete}
                        className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition"
                    >
                        Log Workout
                    </button>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
